program arkanoid;
{$APPTYPE GUI}
{$I zglCustomConfig.cfg}
uses
  wincrt,
  grafika,
  sterowanie,
  sysutils,
  zgl_main,
  zgl_screen,
  zgl_window,
  zgl_timers,
  zgl_keyboard,
  zgl_render_2d,
  zgl_fx,
  zgl_primitives_2d,
  zgl_font,
  zgl_text,
  zgl_math_2d,
  zgl_utils;

var
   DirApp  : UTF8String;
   DirHome : UTF8String;
   fullscreen : Boolean;

   function IntToBool(liczba : shortint) : Boolean;
   Begin
     If liczba = 0 then
       IntToBool := False
     else IntToBool := True;
   end;

procedure odczyt_ustawien();
VAR
  Plik: TextFile;
  Linia: String;
  Wartownik : shortint = 1;

begin
AssignFile(Plik,DirApp+'pliki\ustawienia.txt');
  {$I-};
  Append(Plik);
  {$I+};
  If IOResult <> 0 Then Rewrite(Plik);
  Reset(Plik);
  Repeat
    Readln(Plik,Linia);
      if Wartownik = 1 then
        szerokosc := StrToInt(Linia)
      else if Wartownik = 2 then
        wysokosc := StrToInt(Linia)
      else if Wartownik = 3 then
        fullscreen := IntToBool(StrToInt(Linia))
      else if Wartownik = 4 then
        kolor_pilki := Linia
      else if Wartownik = 6 then
        kolor_paletki := Linia
      else if Wartownik = 8 then
        pseudonim := Linia;
    Inc(Wartownik);
  Until (Eof(Plik));
  CloseFile(Plik);
end;

procedure zapisz_wyniki(nowy : ansistring; zakres : Integer);
var
  Wartownik : Integer;
  Linia : String;
  Plik : TextFile;
  i,j : Integer;
  zabez : shortint = 1;
  //zamien : array [1..50, 1..2] of String;
begin
  podziel_rekord(nowy);
  Wartownik := 1;
  AssignFile(Plik,DirApp+'pliki\statystyki.txt');
  {$I-};
  Append(Plik);
  {$I+};
  Reset(Plik);
  Repeat
    if Wartownik = 1 then
      begin
        Readln(Plik,Linia);
        Rewrite(Plik);
        Writeln(Plik, StrToInt(Linia) + 1);
        Inc(Wartownik);
      end
    else if Wartownik > 1 then begin

      if (StrToInt(czesc[1][1]) > StrToInt(tablica_wynikow[Wartownik][1])) and (zabez <> 0) then begin
        Writeln(Plik,czesc[1][1]+' '+czesc[1][2]);
        zabez := 0;
      end
      else begin
        Writeln(Plik, tablica_wynikow[Wartownik][1] +' '+ tablica_wynikow[Wartownik][2]);
        Inc(Wartownik);
      end;
    end;
  Until Wartownik = 12;
  CloseFile(Plik);
end;

procedure sortuj_wyniki(nowy : ansistring);
  VAR
  Plik: TextFile;
  Linia: ansistring;
  Wartownik : shortint = 1;
  i,j : Integer;
  trick : integer;
  //zamien : array [1..50, 1..2] of ansistring;

begin
AssignFile(Plik,DirApp+'pliki\statystyki.txt');
  {$I-};
  Append(Plik);
  {$I+};
  If IOResult <> 0 Then Rewrite(Plik);
  Reset(Plik);
  Repeat
    Readln(Plik,Linia);
      if Wartownik > 1 then begin
        podziel_rekord(Linia);
        tablica_wynikow[wartownik][1] := czesc[1][1];
        tablica_wynikow[wartownik][2] := czesc[1][2];
      end;
    Inc(Wartownik);
  Until (Eof(Plik));
  CloseFile(Plik);{ stwierdzam, ze nie dziala bo pascal
  for j := 2 to wartownik-2 do begin
    for i := 2 to wartownik-2 do begin
      if StrToInt(tablica_wynikow[i][1]) > StrToInt(tablica_wynikow[i+1][1]) then
        tablica_wynikow[i+20] := tablica_wynikow[i]; tablica_wynikow[i] := tablica_wynikow[i+1]; tablica_wynikow[i+1] := tablica_wynikow[i+20];
    end;
  end;}
  zapisz_wyniki(nowy,wartownik);
end;

begin
  {$IFNDEF USE_ZENGL_STATIC}
    if not zglLoad( libZenGL ) Then exit;
  {$ENDIF}

  DirApp  := utf8_Copy( PAnsiChar( zgl_Get( DIRECTORY_APPLICATION ) ) );
  DirHome := utf8_Copy( PAnsiChar( zgl_Get( DIRECTORY_HOME ) ) );

  odczyt_ustawien();
  wnd_SetCaption('Arkanoid');
  scr_SetOptions( szerokosc, wysokosc, REFRESH_MAXIMUM, fullscreen, FALSE );

  zgl_Init();
end.

